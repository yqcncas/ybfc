(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/oldHouse/oldHouse"],{2669:function(e,t,o){"use strict";(function(e){o("ceaf");n(o("66fd"));var t=n(o("7909"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},3795:function(e,t,o){"use strict";var n={uniSwiperDot:function(){return o.e("components/uni-swiper-dot/uni-swiper-dot").then(o.bind(null,"8735"))},uniGrid:function(){return o.e("components/uni-grid/uni-grid").then(o.bind(null,"7954"))},Guess:function(){return o.e("components/Guess/Guess").then(o.bind(null,"5fd6"))},uPopup:function(){return o.e("node-modules/uview-ui/components/u-popup/u-popup").then(o.bind(null,"6b9d"))},uEmpty:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-empty/u-empty")]).then(o.bind(null,"e7e0"))}},i=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}))},"3cf9":function(e,t,o){},7909:function(e,t,o){"use strict";o.r(t);var n=o("3795"),i=o("9ef1");for(var a in i)"default"!==a&&function(e){o.d(t,e,(function(){return i[e]}))}(a);o("8a8a");var s,r=o("f0c5"),c=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=c.exports},"79b7":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("4795")),i=a(o("d66d"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,o,n,i,a,s){try{var r=e[a](s),c=r.value}catch(u){return void o(u)}r.done?t(c):Promise.resolve(c).then(n,i)}function r(e){return function(){var t=this,o=arguments;return new Promise((function(n,i){var a=e.apply(t,o);function r(e){s(a,n,i,r,c,"next",e)}function c(e){s(a,n,i,r,c,"throw",e)}r(void 0)}))}}var c=null,u=function(){o.e("components/uni-swiper-dot/uni-swiper-dot").then(function(){return resolve(o("8735"))}.bind(null,o)).catch(o.oe)},h=function(){o.e("components/Guess/Guess").then(function(){return resolve(o("5fd6"))}.bind(null,o)).catch(o.oe)},l=function(){o.e("components/uni-grid/uni-grid").then(function(){return resolve(o("7954"))}.bind(null,o)).catch(o.oe)},d=function(){Promise.all([o.e("common/vendor"),o.e("components/Modal/loginModal")]).then(function(){return resolve(o("b83e"))}.bind(null,o)).catch(o.oe)},f={name:"oldHouse",components:{uniSwiperDot:u,Guess:h,uniGrid:l,loginModal:d},data:function(){return{houseId:"",height:64,top:0,scrollH:0,opcity:0,iconOpcity:.5,current:0,mode:"nav",dotsStyles:{backgroundColor:"rgba(0, 0, 0, .3)",border:"1px rgba(0, 0, 0, .3) solid",color:"#fff",selectedBackgroundColor:"rgba(0, 0, 0, .9)",selectedBorder:"1px rgba(0, 0, 0, .9) solid"},autoplay:!1,interval:3e3,circular:!0,swiperList:[],isVideo:"",videoPic:"",isImg:"",islayOut:"",length:"",oldHouseInfo:{},lat:"",lng:"",markers:[],avatar:"",userName:"",company:"",homeList:[],houseType:"",isCollect:"",mobile:"",postName:"",userId:"",isAdmin:!1,roomConfig:[{image:"../../static/icon/bed-off.png",text:"床",have:!1},{image:"../../static/icon/bingxiang-off.png",text:"冰箱",have:!1},{image:"../../static/icon/kongtiao-off.png",text:"空调",have:!1},{image:"../../static/icon/xiyi-off.png",text:"洗衣机",have:!1},{image:"../../static/icon/tv-off.png",text:"电视",have:!1},{image:"../../static/icon/wifi-off.png",text:"宽带",have:!1},{image:"../../static/icon/sofa-off.png",text:"沙发",have:!1},{image:"../../static/icon/zuofan-off.png",text:"可做饭",have:!1},{image:"../../static/icon/yigui-off.png",text:"衣柜",have:!1},{image:"../../static/icon/yangtai-off.png",text:"阳台",have:!1},{image:"../../static/icon/nuanqi-off.png",text:"暖气",have:!1},{image:"../../static/icon/reshui-off.png",text:"热水器",have:!1},{image:"../../static/icon/wc-off.png",text:"卫生间",have:!1}],isToken:!1,manager:"",loadShow:!1,backHome:!1,phone:"",modalShow:!1,flag:!0,ownerName:"",path:"",shareTitle:"",shareUserId:"",favoritesShow:!1,isEmpty:!1,favoritesList:[],chooseFavorites:"",favoritesName:"",addShow:!1,userMobile:"",verCode:"",count:60,verificationFlag:!1,from:"",clientName:"",shareImg:"https://img.bajiaostar.com/2e0268c4601672d79e140d888a1f9e40",share:""}},methods:{back:function(){this.backHome?e.switchTab({url:"../home/home"}):e.navigateBack({delta:1})},change:function(e){this.current=e.detail.current},bMapToTxMap:function(e,t){var o=new Object,n=52.35987755982988,i=t-.0065,a=e-.006,s=Math.sqrt(i*i+a*a)-2e-5*Math.sin(a*n),r=Math.atan2(a,i)-3e-6*Math.cos(i*n),c=s*Math.cos(r),u=s*Math.sin(r);return o.longitude=c,o.latitude=u,o},getHouseInfo:function(){var t=this;return r(n.default.mark((function o(){var a,s,r,c,u,h;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.swiperList=[],o.next=3,t.$fetch(t.$api.houseInfo,{houseId:t.houseId},"GET");case 3:a=o.sent,t.isCollect=a.data.collect,a.data.oldHouse.movieUrl?(t.videoPic=a.data.oldHouse.movieFirst,t.swiperList.push(a.data.oldHouse.movieUrl),t.isVideo=!0):t.isVideo=!1,a.data.oldHouse.picUrl?(s=a.data.oldHouse.picUrl.split(","),s[0]&&(t.shareImg=s[0],console.log(t.shareImg)),s.forEach((function(e){t.swiperList.push(e)})),t.isImg=!0):t.isImg=!1,a.data.oldHouse.layoutPic?(r=a.data.oldHouse.layoutPic.split(","),r.forEach((function(e){t.swiperList.push(e)})),t.islayOut=!0):t.islayOut=!1,t.length=t.swiperList.length,a.data.oldHouse.createTime=t.$dayjs(a.data.oldHouse.createTime).format("YYYY-MM-DD"),t.oldHouseInfo=a.data.oldHouse,c=t.bMapToTxMap(t.oldHouseInfo.latitude,t.oldHouseInfo.longitude),t.lat=c.latitude,t.lng=c.longitude,t.markers.push({id:1,latitude:t.lat,longitude:t.lng,alpha:1,iconPath:"../../static/icon/Group23.png"}),u=a.data.manager,t.manager||(t.avatar=i.default.pro+"profile/avatar/"+u.avatar,t.userName=u.userName,t.company=u.company,t.phone=u.loginName,t.postName=u.postName,t.userId=u.userId),1==t.isAdmin?t.path="pages/oldHouse/oldHouse?houseId="+t.houseId+"&houseType="+t.houseType+"&userId="+t.shareUserId+"&share=1":t.path="pages/oldHouse/oldHouse?houseId="+t.houseId+"&houseType="+t.houseType+"&share=1",t.shareTitle=a.data.oldHouse.houseName,t.mobile=u.phonenumber,a.data.guess.forEach((function(e){e.picUrl?e.picUrl=e.picUrl.split(","):e.picUrl="https://img.bajiaostar.com/FnwyfqiIK3_RD5UR1k66KQ_y0VFx".split(","),e.label&&(e.label=e.label.split(","))})),t.homeList=a.data.guess,h=a.data.oldHouse.houseSet,-1!=h.indexOf("101")&&(t.roomConfig[0].image="../../static/icon/bed.png",t.roomConfig[0].have=!0),-1!=h.indexOf("102")&&(t.roomConfig[1].image="../../static/icon/bingxiang.png",t.roomConfig[1].have=!0),-1!=h.indexOf("103")&&(t.roomConfig[2].image="../../static/icon/kongtiao.png",t.roomConfig[2].have=!0),-1!=h.indexOf("104")&&(t.roomConfig[3].image="../../static/icon/xiyi.png",t.roomConfig[3].have=!0),-1!=h.indexOf("105")&&(t.roomConfig[4].image="../../static/icon/tv.png",t.roomConfig[4].have=!0),-1!=h.indexOf("106")&&(t.roomConfig[5].image="../../static/icon/wifi.png",t.roomConfig[5].have=!0),-1!=h.indexOf("107")&&(t.roomConfig[6].image="../../static/icon/sofa.png",t.roomConfig[6].have=!0),-1!=h.indexOf("108")&&(t.roomConfig[7].image="../../static/icon/zuofan.png",t.roomConfig[7].have=!0),-1!=h.indexOf("109")&&(t.roomConfig[8].image="../../static/icon/yigui.png",t.roomConfig[8].have=!0),-1!=h.indexOf("110")&&(t.roomConfig[9].image="../../static/icon/yangtai.png",t.roomConfig[9].have=!0),-1!=h.indexOf("111")&&(t.roomConfig[10].image="../../static/icon/nuanqi.png",t.roomConfig[10].have=!0),-1!=h.indexOf("112")&&(t.roomConfig[11].image="../../static/icon/reshui.png",t.roomConfig[11].have=!0),-1!=h.indexOf("113")&&(t.roomConfig[12].image="../../static/icon/wc.png",t.roomConfig[12].have=!0),0==t.swiperList.length&&(t.swiperList[0]="https://img.bajiaostar.com/FnwyfqiIK3_RD5UR1k66KQ_y0VFx"),t.loadShow=!0,e.hideLoading();case 39:case"end":return o.stop()}}),o)})))()},goVideo:function(){this.current=0},goImg:function(){this.isVideo?this.current=1:this.current=0},goLayOut:function(){this.current=this.length-1},videoPlay:function(){var t=e.createVideoContext("houseVideo");t.requestFullScreen({direction:90})},callTel:function(){var t=this;this.isAdmin?e.showModal({title:"拨打电话",content:"拨打"+this.oldHouseInfo.ownerName+"电话:"+this.mobile,success:function(o){o.confirm&&e.makePhoneCall({phoneNumber:t.mobile})}}):e.showModal({title:"拨打电话",content:"拨打经纪人电话:"+this.phone,success:function(o){o.confirm&&e.makePhoneCall({phoneNumber:t.phone})}})},handleToShowFavorites:function(){var t=this;return r(n.default.mark((function o(){var i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.$fetch(t.$api.favoriteList,{},"GET");case 2:i=o.sent,console.log(i),0==i.code?(i.data.length>0?t.isEmpty=!1:t.isEmpty=!0,t.favoritesList=i.data,t.favoritesShow=!0):401==i.code&&(e.showToast({icon:"none",title:i.msg}),setTimeout((function(){e.navigateTo({url:"../login/login"})}),1e3));case 5:case"end":return o.stop()}}),o)})))()},handleCloseFavor:function(){this.favoritesShow=!1,this.chooseFavorites=""},handleChoose:function(e){this.chooseFavorites=e},handleShowAddFavorites:function(){this.favoritesShow=!1,this.addShow=!0},handleCloseAdd:function(){this.addShow=!1,this.favoritesShow=!0},handleAddFavor:function(){var t=this;return r(n.default.mark((function o(){var i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.$fetch(t.$api.addFavorite,{name:t.favoritesName},"GET");case 2:i=o.sent,console.log(i),e.showToast({icon:"none",title:i.msg}),0==i.code&&(t.addShow=!1,t.favoritesName="",t.handleToShowFavorites());case 6:case"end":return o.stop()}}),o)})))()},collect:function(){var t=this;return r(n.default.mark((function o(){var i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(t.chooseFavorites){o.next=2;break}return o.abrupt("return",e.showToast({icon:"none",title:"请选择收藏夹"}));case 2:return o.next=4,t.$fetch(t.$api.collect,{houseId:t.houseId,houseType:t.houseType,favoriteId:t.chooseFavorites},"GET");case 4:i=o.sent,0==i.code&&(t.isCollect=1,t.favoritesShow=!1,t.chooseFavorites=""),e.showToast({icon:"none",title:i.msg});case 7:case"end":return o.stop()}}),o)})))()},checkFollow:function(){e.navigateTo({url:"../followList/followList?id="+this.houseId})},checkMap:function(){e.navigateTo({url:"houseMap?lat="+this.lat+"&lng="+this.lng})},goArea:function(t){e.navigateTo({url:"../xiaoqu/areaDetail?areaId="+t})},checkAgent:function(t){e.navigateTo({url:"../agent/agentDetail?id="+t})},viewImage:function(t){e.previewImage({urls:this.swiperList,current:t,loop:!0})},goShare:function(){this.isToken?e.navigateTo({url:"../share/share?id="+this.houseId+"&houseType="+this.houseType}):(e.showToast({icon:"none",title:"请先登录！"}),setTimeout((function(){e.navigateTo({url:"../login/login"})}),1e3))},getManagerInfo:function(){var e=this;return r(n.default.mark((function t(){var o,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$fetch(e.$api.getAgentInfo,{userId:e.manager},"GET");case 2:o=t.sent,a=o.data.user,e.avatar=i.default.pro+"profile/avatar/"+a.avatar,e.userName=a.userName,e.company=a.company,e.phone=a.phonenumber,e.postName=a.postName,e.userId=a.userId;case 10:case"end":return t.stop()}}),t)})))()},modalClose:function(e){this.modalShow=e},getToken:function(t){e.setStorageSync("token",t),e.setStorageSync("isAdmin",!1),e.setStorageSync("isToken",!0),this.isToken=!0},addH5Browse:function(){var e=this;return r(n.default.mark((function t(){var o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$fetch(e.$api.addH5Browse,{clientName:e.clientName,houseId:e.houseId,houseType:e.houseType,manager:e.manager},"GET");case 2:o=t.sent,console.log(o);case 4:case"end":return t.stop()}}),t)})))()},handleToAuthorize:function(){e.setStorageSync("shareHouseId",this.houseId),e.setStorageSync("shareHouseType",this.houseType),e.setStorageSync("shareManager",this.manager),this.share&&e.setStorageSync("shareFrom",this.share),window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat(this.$api.appid,"&redirect_uri=").concat(this.$api.redirectUrl,"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirec")},getSDKSign:function(){var e=this;return r(n.default.mark((function t(){var o,i,a,s,r,c,u,h;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=location.href,t.next=3,e.$fetch(e.$api.getSDKSign,{url:o},"POST","form");case 3:i=t.sent,a=i.data.noncestr,s=i.data.timestamp,r=i.data.sign,console.log(e.oldHouseInfo.houseName),c=e.oldHouseInfo.houseName,u=location.href+"&shareFlag=1",h=e.shareImg,jwx.config({appId:e.$api.appid,timestamp:s,nonceStr:a,signature:r,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]}),jwx.ready((function(){jwx.updateAppMessageShareData({title:c,desc:"温州英棒房产，为您提供真实，有效，准确真房源!",link:u,imgUrl:h,success:function(){console.log("成功设置分享到微信")}}),jwx.updateTimelineShareData({title:c,link:u,imgUrl:h,success:function(){console.log("成功设置分享到朋友圈")}})}));case 13:case"end":return t.stop()}}),t)})))()},handleToRefuse:function(){var t=this;e.showModal({title:"提醒",content:"你确定要取消授权吗？",success:function(e){e.confirm&&(t.modalShow=!1)}})}},onLoad:function(t){var o=this;e.showLoading({title:"加载中"});var n={};if(n=wx.getMenuButtonBoundingClientRect(),e.getSystemInfo({success:function(e){o.width=n.left||e.windowWidth,o.height=n.top?n.top+n.height+8:e.statusBarHeight+44,o.top=n.top?n.top+(n.height-32)/2:e.statusBarHeight+6,o.scrollH=e.windowWidth}}),console.log(t),t.scene){this.backHome=!0;var i=decodeURIComponent(t.scene);this.houseId=i.split("&")[0],this.houseType=i.split("&")[1],i.split("&")[2]&&(this.manager=i.split("&")[2],e.setStorageSync("manager",this.manager))}else this.houseId=t.houseId,this.houseType=t.houseType,t.userId&&(this.manager=t.userId,console.log(this.manager),e.setStorageSync("manager",this.manager)),t.share?this.backHome=!0:this.backHome=!1,t.flag?this.flag=!0:this.flag=!1;this.getHouseInfo()},onShow:function(){var t=this;e.getStorageSync("isAdmin")&&(this.isAdmin=e.getStorageSync("isAdmin"),this.shareUserId=e.getStorageSync("userId")),e.getStorageSync("isToken")&&(this.isToken=e.getStorageSync("isToken")),e.getStorageSync("manager")||(this.manager=""),(this.backHome||this.flag)&&(this.isToken?this.manager&&this.getManagerInfo():this.manager&&(this.getManagerInfo(),setTimeout((function(){t.modalShow=!0}),1e3)))},onPageScroll:function(e){var t=e.scrollTop<=0?0:e.scrollTop,o=t/this.scrollH;this.opcity>=1&&o>=1||(this.opcity=o,this.iconOpcity=.5*(1-o<0?0:1-o))},onShareAppMessage:function(e){return e.from,{title:this.shareTitle,path:this.path}},onUnload:function(){c&&clearInterval(c)}};t.default=f}).call(this,o("543d")["default"])},"8a8a":function(e,t,o){"use strict";var n=o("3cf9"),i=o.n(n);i.a},"9ef1":function(e,t,o){"use strict";o.r(t);var n=o("79b7"),i=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a}},[["2669","common/runtime","common/vendor"]]]);